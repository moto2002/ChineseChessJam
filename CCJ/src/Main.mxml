<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/halo" 
			   xmlns:components="com.lookbackon.ccj.view.components.*"
			   creationComplete="application1_creationCompleteHandler(event)" >
	<s:layout>
		<s:BasicLayout/>
	</s:layout>
	<fx:Script>
		<![CDATA[
			import com.lookbackon.ccj.CcjConstants;
			import com.lookbackon.ccj.ChessPiecesConstants;
			import com.lookbackon.ccj.business.factory.ChessFactory;
			import com.lookbackon.ccj.managers.GameManager;
			import com.lookbackon.ccj.model.ChessPiecesModel;
			import com.lookbackon.ccj.model.vos.ConductVO;
			import com.lookbackon.ccj.utils.LogUtil;
			import com.lookbackon.ccj.view.components.ChessPiece;
			import com.lookbackon.ccj.view.components.IChessPiece;
			
			import mx.events.FlexEvent;
			import mx.logging.ILogger;
			import mx.logging.LogEventLevel;
			
			//--------------------------------------------------------------------------
			//
			//  Variables
			//
			//--------------------------------------------------------------------------
			[Bindable]
			private var chessPositionModel:ChessPiecesModel = ChessPiecesModel.getInstance();
			//
			private var chessPieces:Array = [];
			//
			[Bindable]
			private var logFilters:Array = ["com.lookbackon.ccj.business.factory.ChessFactory"];
			//----------------------------------
			//  CONSTANTS
			//----------------------------------
			private static const LOG:ILogger = LogUtil.getLogger(Main);
			//--------------------------------------------------------------------------
			//
			//  Methods
			//
			//--------------------------------------------------------------------------
			//  application1_creationCompleteHandler
			protected function application1_creationCompleteHandler(event:FlexEvent):void
			{
				// TODO Auto-generated method stub
				//create chess gaskets.
				for(var h:int=0;h<CcjConstants.BOARD_H_LINES;h++)
				{
					for(var v:int=0;v<CcjConstants.BOARD_V_LINES;v++)
					{
						this.addElement( ChessFactory.createChessGasket([h,v]) );
					}
				}
				//create chess piece
				for(var hh:int=0;hh<CcjConstants.BOARD_H_LINES;hh++)
				{
					for(var vv:int=0;vv<CcjConstants.BOARD_V_LINES;vv++)
					{
						var iChessPiece:IChessPiece = ChessFactory.createChessPiece([hh,vv]);
						if(iChessPiece!=null)
						{
							this.addElement( iChessPiece );
							this.chessPieces.push(iChessPiece);
						}
					}
				}
				//create chess pieces' chessVO
				for(var cp:int=0;cp<this.chessPieces.length;cp++)
				{
					var chessPiece:ChessPiece = this.chessPieces[cp] as ChessPiece;
					//generateChessPieceVO
					var conductVO:ConductVO = new ConductVO();
					conductVO.target = chessPiece;
					conductVO.newPosition = chessPiece.position;
					chessPiece.chessVO = ChessFactory.generateChessPieceVO(conductVO);
				}
				//init data struct.@seechessPositionModelLocator dump info.
				LOG.debug("redPieces:{0}",chessPositionModel.redPieces.dump());
				LOG.debug("bluePieces:{0}",chessPositionModel.bluePieces.dump());
				LOG.debug("allPieces:{0}",chessPositionModel.allPieces.dump());
				//
				LOG.debug("allPieces rotate90:{0}",chessPositionModel.allPieces.rotate90().dump());
				LOG.debug("allPieces rotate90.bitCount:{0}",chessPositionModel.allPieces.bitCount);
				LOG.debug("allPieces rotate90.cellCount:{0}",chessPositionModel.allPieces.cellCount);
				//GameManager start.
//				GameManager.startGame();
			}

		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<s:TraceTarget fieldSeparator="->"
					   includeCategory="true"
					   includeDate="false"
					   includeLevel="true"
					   includeTime="true"
					   level="{LogEventLevel.INFO}"
					   />
		<!-- filters="{logFilters}" -->
	</fx:Declarations>
	
	<!-- Views here -->
	<components:ChessBoard left="50" right="50" top="25" bottom="25"/>
	
</s:Application>
